<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Jewelry Store</title>
    <link href="index.css" rel="stylesheet" type="text/css">
    <link href="Appointment.css" rel="stylesheet" type="text/css">
    <script src="Appointment.js"></script>
</head>
<body>

<header>
    <h1>Welcome to Our Online Jewelry Store</h1>
</header>

<nav>
    <a href="index.html">Home</a>
    <a href="rings.html">Rings</a>
    <a href="necklaces.html">Necklaces</a>
    <a href="Bracelets.html">Bracelets</a>
    <a href="Earrings.html">Earrings</a>
    <a href="Appointment.html">Book Appointment</a>
</nav>

<title>Appointment Booking</title>

<div class="container">
    <h2>Book an Appointment</h2>
    <form id="booking-form" action="https://formsubmit.co/98e9e2bfb837420b74a2ab4fc2da3ebd" method="POST">
        <label>Full name</label>
        <input type="text" name="name" required>
        <label>Email</label>
        <input type="email" name="email" required>
        <label>Number of people attending</label>
        <input type="number" name="Number of people attending" required>
        <label>Date</label>
        <input type="date" name="Date" id="appointment-date" required>
        <label>Time</label>
        <select name="time" id="appointment-time" required></select>
        <input type="hidden" name="_autoresponse" value="Thank you for booking your appointment! 
        You should be receiving your confirmation email shortly! Your appointment information is below!">
        <input type="hidden" name="_next" value="https://gorgeous-platypus-25d0b5.netlify.app/appointment">
        <button type="submit">Book Appointment</button>
   </form>
    <div id="message"></div>
</div>

<div id="calendar"></div>

<footer>
    <p>&copy; 2024 Online Jewelry Store</p>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const dateField = document.getElementById('appointment-date');
        const timeField = document.getElementById('appointment-time');
        const bookingForm = document.getElementById('booking-form');

        const today = new Date().toISOString().split('T')[0];
        dateField.setAttribute('min', today);

        const generateDefaultTimes = () => {
            const times = [];
            for (let hour = 9; hour <= 17; hour++) {
                times.push(`${hour.toString().padStart(2, '0')}:00`);
            }
            return times;
        };

        const updateAvailableTimes = () => {
            const selectedDate = dateField.value;
            const unavailableAppointments = JSON.parse(localStorage.getItem('unavailableAppointments') || '[]');
            const unavailableTimes = unavailableAppointments.filter(app => app.date === selectedDate).map(app => app.time);
            const availableTimes = generateDefaultTimes().filter(time => !unavailableTimes.includes(time));
            
            if (availableTimes.length === 0) {
                timeField.setAttribute('disabled', 'true');
                timeField.innerHTML = '';
            } else {
                timeField.removeAttribute('disabled');
                availableTimes.sort((a, b) => new Date(selectedDate + 'T' + a) - new Date(selectedDate + 'T' + b));
                timeField.innerHTML = availableTimes.map(time => `<option value="${time}">${time}</option>`).join('');
            }
        };

        dateField.addEventListener('change', updateAvailableTimes);

        bookingForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const formData = new FormData(bookingForm);
            const name = formData.get('name');
            const email = formData.get('email');
            const numberOfPeople = formData.get('Number of people attending');
            const date = formData.get('Date');
            const time = formData.get('time');

            const unconfirmed = JSON.parse(localStorage.getItem('unconfirmedAppointments') || '[]');
            unconfirmed.push({ date, time, name, numberOfPeople });
            localStorage.setItem('unconfirmedAppointments', JSON.stringify(unconfirmed));

            const unavailableAppointments = JSON.parse(localStorage.getItem('unavailableAppointments') || '[]');
            unavailableAppointments.push({ date, time });
            localStorage.setItem('unavailableAppointments', JSON.stringify(unavailableAppointments));

            alert('Appointment booked and waiting for admin confirmation.');
            window.location.reload();
        });

        // Initial load of available times
        updateAvailableTimes();
    });
</script>

</body>
</html>
