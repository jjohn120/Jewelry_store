<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Manage Appointments</title>
    <link href="index.css" rel="stylesheet" type="text/css">
    <link href="Appointment.css" rel="stylesheet" type="text/css">
    <link href='https://unpkg.com/@fullcalendar/core@6/main.min.css' rel='stylesheet' />
    <link href='https://unpkg.com/@fullcalendar/daygrid@6/main.min.css' rel='stylesheet' />
    <script src='https://unpkg.com/@fullcalendar/core@6/main.min.js'></script>
    <script src='https://unpkg.com/@fullcalendar/daygrid@6/main.min.js'></script>
</head>
<body>

<header>
    <h1>Admin - Manage Appointments</h1>
</header>

<div class="container">
    <h2>Set Available Appointments</h2>
    <form id="admin-form">
        <label for="admin-date">Date</label>
        <input type="date" id="admin-date" required>
        <button type="submit">Add 9 to 5 Slots</button>
    </form>
    <h2>Remove Specific Appointment</h2>
    <form id="remove-form">
        <label for="remove-date">Date</label>
        <input type="date" id="remove-date" required>
        <label for="remove-time">Time</label>
        <input type="time" id="remove-time" required>
        <button type="submit">Remove Slot</button>
    </form>
    <h2>Confirm Appointments</h2>
    <div id="unconfirmed-appointments"></div>
    <h2>Available Appointments</h2>
    <div id="available-appointments"></div>
    <h2>Calendar View</h2>
    <div id="calendar"></div>
</div>

<footer>
    <p>&copy; 2024 Online Jewelry Store</p>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const adminForm = document.getElementById('admin-form');
        const removeForm = document.getElementById('remove-form');
        const availableAppointments = document.getElementById('available-appointments');
        const unconfirmedAppointments = document.getElementById('unconfirmed-appointments');
        const calendarEl = document.getElementById('calendar');
        
        const calendar = new FullCalendar.Calendar(calendarEl, {
            plugins: ['dayGrid'],
            initialView: 'dayGridMonth',
            events: []
        });
        calendar.render();

        const loadAppointments = () => {
            const appointments = JSON.parse(localStorage.getItem('availableAppointments') || '[]');
            appointments.sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time));
            availableAppointments.innerHTML = appointments.map(app => `
                <div>
                    ${app.date} at ${formatTime(app.time)}
                    <button onclick="removeAppointment('${app.date}', '${app.time}')">Remove</button>
                </div>
            `).join('');
            updateCalendarEvents();
        };

        const loadUnconfirmedAppointments = () => {
            const unconfirmed = JSON.parse(localStorage.getItem('unconfirmedAppointments') || '[]');
            unconfirmed.sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time));
            unconfirmedAppointments.innerHTML = unconfirmed.map(app => `
                <div>
                    ${app.date} at ${formatTime(app.time)}
                    <button onclick="confirmBooking('${app.date}', '${app.time}')">Confirm Booking</button>
                </div>
            `).join('');
            updateCalendarEvents();
        };

        const formatTime = (time) => {
            let [hours, minutes] = time.split(':');
            const period = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12 || 12;
            return `${hours}:${minutes} ${period}`;
        };

        const add9to5Slots = (date) => {
            const appointments = JSON.parse(localStorage.getItem('availableAppointments') || '[]');
            for (let hour = 9; hour < 18; hour++) {
                const time = hour.toString().padStart(2, '0') + ':00';
                if (!appointments.find(app => app.date === date && app.time === time)) {
                    appointments.push({ date, time });
                }
            }
            localStorage.setItem('availableAppointments', JSON.stringify(appointments));
            loadAppointments();
        };

        adminForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const date = document.getElementById('admin-date').value;
            add9to5Slots(date);
        });

        removeForm.addEventListener('submit', function(event) {
            event.preventDefault();
            const date = document.getElementById('remove-date').value;
            const time = document.getElementById('remove-time').value;
            removeAppointment(date, time);
        });

        window.removeAppointment = (date, time) => {
            let appointments = JSON.parse(localStorage.getItem('availableAppointments') || '[]');
            appointments = appointments.filter(app => app.date !== date || app.time !== time);
            localStorage.setItem('availableAppointments', JSON.stringify(appointments));
            loadAppointments();
        };

        window.confirmBooking = (date, time) => {
            let unconfirmed = JSON.parse(localStorage.getItem('unconfirmedAppointments') || '[]');
            unconfirmed = unconfirmed.filter(app => app.date !== date || app.time !== time);
            localStorage.setItem('unconfirmedAppointments', JSON.stringify(unconfirmed));
            loadUnconfirmedAppointments();
        };

        const updateCalendarEvents = () => {
            calendar.removeAllEvents();
            const appointments = JSON.parse(localStorage.getItem('availableAppointments') || '[]');
            const unconfirmed = JSON.parse(localStorage.getItem('unconfirmedAppointments') || '[]');
            appointments.forEach(app => {
                calendar.addEvent({
                    title: 'Available',
                    start: app.date + 'T' + app.time
                });
            });
            unconfirmed.forEach(app => {
                calendar.addEvent({
                    title: 'Unconfirmed',
                    start: app.date + 'T' + app.time,
                    color: 'red'
                });
            });
        };

        loadAppointments();
        loadUnconfirmedAppointments();
    });
</script>

</body>
</html>
